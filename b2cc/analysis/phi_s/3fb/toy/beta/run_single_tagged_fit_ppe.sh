#!/bin/bash

source /cvmfs/lhcb.cern.ch/group_login.sh
/cvmfs/lhcb.cern.ch/lib/lhcb/LBSCRIPTS/LBSCRIPTS_v7r10p4/InstallArea/scripts/SetupProject.sh DaVinci

RAPIDFITROOT=/Home/gcowan1/software/RapidFit/trunk
BC=/Home/gcowan1/lhcb/lhcb/b2cc/analysis/phi_s/3fb/toy/beta
CONFIG1=$BC/untagged_fit.xml

export PYTHONPATH=/cvmfs/lhcb.cern.ch/lib/lhcb/LHCB/LHCB_v37r1p1/InstallArea/x86_64-slc6-gcc48-opt/python/lib-dynload:/cvmfs/lhcb.cern.ch/lib/lhcb/GAUDI/GAUDI_v25r1p1/InstallArea/x86_64-slc6-gcc48-opt/python/lib-dynload:/cvmfs/lhcb.cern.ch/lib/lhcb/DAVINCI/DAVINCI_v34r1p1/InstallArea/x86_64-slc6-gcc48-opt/python.zip:/cvmfs/lhcb.cern.ch/lib/lhcb/ANALYSIS/ANALYSIS_v12r1p1/InstallArea/x86_64-slc6-gcc48-opt/python.zip:/cvmfs/lhcb.cern.ch/lib/lhcb/STRIPPING/STRIPPING_v8r1p1/InstallArea/x86_64-slc6-gcc48-opt/python.zip:/cvmfs/lhcb.cern.ch/lib/lhcb/PHYS/PHYS_v18r1p1/InstallArea/x86_64-slc6-gcc48-opt/python.zip:/cvmfs/lhcb.cern.ch/lib/lhcb/REC/REC_v16r1p1/InstallArea/x86_64-slc6-gcc48-opt/python.zip:/cvmfs/lhcb.cern.ch/lib/lhcb/LBCOM/LBCOM_v15r1p1/InstallArea/x86_64-slc6-gcc48-opt/python.zip:/cvmfs/lhcb.cern.ch/lib/lhcb/LHCB/LHCB_v37r1p1/InstallArea/x86_64-slc6-gcc48-opt/python.zip:/cvmfs/lhcb.cern.ch/lib/lhcb/GAUDI/GAUDI_v25r1p1/InstallArea/x86_64-slc6-gcc48-opt/python.zip:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/pyanalysis/1.4_python2.7/x86_64-slc6-gcc48-opt/lib/python2.7/site-packages:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/pygraphics/1.4_python2.7/x86_64-slc6-gcc48-opt/lib/python2.7/site-packages:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/CORAL/CORAL_3_0_0-pre1/x86_64-slc6-gcc48-opt/python:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/CORAL/CORAL_3_0_0-pre1/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lhcb/DBASE/RawEventFormat/v1r0p3/python:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/pytools/1.8_python2.7/x86_64-slc6-gcc48-opt/lib/python2.7/site-packages:/cvmfs/lhcb.cern.ch/lib/lhcb/DBASE/PRConfig/v1r10/python:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/ROOT/v5-99-05-lhcb/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lhcb/LBSCRIPTS/LBSCRIPTS_v7r10p4/InstallArea/python
export PATH=/cvmfs/lhcb.cern.ch/lib/lhcb/ANALYSIS/ANALYSIS_v12r1p1/InstallArea/x86_64-slc6-gcc48-opt/scripts:/cvmfs/lhcb.cern.ch/lib/lhcb/STRIPPING/STRIPPING_v8r1p1/InstallArea/x86_64-slc6-gcc48-opt/scripts:/cvmfs/lhcb.cern.ch/lib/lhcb/LHCB/LHCB_v37r1p1/InstallArea/x86_64-slc6-gcc48-opt/scripts:/cvmfs/lhcb.cern.ch/lib/lhcb/GAUDI/GAUDI_v25r1p1/InstallArea/x86_64-slc6-gcc48-opt/scripts:/cvmfs/lhcb.cern.ch/lib/lhcb/ANALYSIS/ANALYSIS_v12r1p1/InstallArea/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lhcb/PHYS/PHYS_v18r1p1/InstallArea/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lhcb/LHCB/LHCB_v37r1p1/InstallArea/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lhcb/GAUDI/GAUDI_v25r1p1/InstallArea/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/pyanalysis/1.4_python2.7/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/pygraphics/1.4_python2.7/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/oracle/11.2.0.3.0/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/sqlite/3070900/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/COOL/COOL_3_0_0-pre1/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/CORAL/CORAL_3_0_0-pre1/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/pytools/1.8_python2.7/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/mysql/5.5.27/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/XercesC/3.1.1p1/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/ROOT/v5-99-05-lhcb/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/xrootd/3.2.7/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/gccxml/0.9.0_20131026/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/tcmalloc/1.7p3/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/Python/2.7.6/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/gcc/4.8.1/x86_64-slc6/bin:/cvmfs/lhcb.cern.ch/lib/lhcb/COMPAT/COMPAT_v1r18/CompatSys/x86_64-slc6-gcc48-opt/bin:/cvmfs/lhcb.cern.ch/lib/contrib/CMT/v1r20p20090520/Linux-x86_64:/cvmfs/lhcb.cern.ch/lib/lhcb/LBSCRIPTS/LBSCRIPTS_v7r10p4/InstallArea/scripts:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68/gcc/4.8.1/x86_64-slc6/bin:/cvmfs/lhcb.cern.ch/lib/contrib/CMake/2.8.9/Linux-i386/bin:/ifp/java/eclipse/:/usr/lib64/qt-3.3/bin:/opt/mendeleydesktop/bin:/usr/local/bin:/bin:/usr/bin:/usr/sbin:/sbin:/opt/vasp/4.6:/opt/rw05-3:/opt/maple15/bin:/opt/dell/srvadmin/bin
export LD_LIBRARY_PATH=/cvmfs/lhcb.cern.ch/lib/lhcb/ANALYSIS/ANALYSIS_v12r1p1/InstallArea/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lhcb/STRIPPING/STRIPPING_v8r1p1/InstallArea/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lhcb/PHYS/PHYS_v18r1p1/InstallArea/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lhcb/REC/REC_v16r1p1/InstallArea/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lhcb/LBCOM/LBCOM_v15r1p1/InstallArea/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lhcb/LHCB/LHCB_v37r1p1/InstallArea/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lhcb/GAUDI/GAUDI_v25r1p1/InstallArea/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/pyanalysis/1.4_python2.7/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/lapack/3.4.0/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/blas/20110419/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/fastjet/3.0.6/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/pygraphics/1.4_python2.7/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/neurobayes_expert/3.7.0/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/RELAX/RELAX-root6/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/vdt/0.3.6/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/oracle/11.2.0.3.0/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/sqlite/3070900/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/COOL/COOL_3_0_0-pre1/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/CORAL/CORAL_3_0_0-pre1/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/HepMC/2.06.08/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/pytools/1.8_python2.7/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/mysql/5.5.27/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/clhep/1.9.4.7/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/XercesC/3.1.1p1/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/GSL/1.10/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/Boost/1.55.0_python2.7/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/ROOT/v5-99-05-lhcb/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/xrootd/3.2.7/x86_64-slc6-gcc48-opt/lib64:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/tcmalloc/1.7p3/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/libunwind/5c2cade/x86_64-slc6-gcc48-opt/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/gcc/4.8.1/x86_64-slc6/lib64:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/fftw3/3.1.2/x86_64-slc6-gcc48-opt/lib:/usr/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68/gcc/4.8.1/x86_64-slc6/lib64:/usr/lib64/root:/Disk/lochnagar0/lhcb/lhcb-soft/lcg/external/dcache_client/1.8.0/slc4_ia32_gcc34/dcap/lib/:/Home/gcowan1/Teaching/NumericalRecipes/Unit1-Matrices/cpp/acml/gfortran64_int64/lib:/Disk/lochnagar0/lhcb/lhcb-soft/lcg/external/castor/2.1.1-9/slc4_ia32_gcc34/usr/lib:/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/Python/2.7.6/x86_64-slc6-gcc48-opt/lib

PYTHON=/cvmfs/lhcb.cern.ch/lib/lcg/releases/LCG_68_root6/Python/2.7.6/x86_64-slc6-gcc48-opt/bin/python

myID=`hostid`_$RANDOM
workdir=/tmp/${myID}
mkdir -p $workdir
echo "Workdir "$workdir
cd $workdir

$RAPIDFITROOT/bin/fitting -f $CONFIG1 --doPulls pulls.root --OutputLevel 2

datadir=$BC/quadratic_only/
mkdir -p $datadir
cd $datadir

cp -f  $workdir/pulls.root ${myID}_pulls.root
#rm -rf $workdir
